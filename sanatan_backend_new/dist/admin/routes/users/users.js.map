{"version":3,"file":"users.js","names":["express","require","router","Router","User","Admin","Invoice","Wishlist","Collection","asyncHandler","default","mongoose","fetchAdmins","req","res","users","find","status","json","error","message","fetchUsers","page","parseInt","query","limit","aggregate","$addFields","created","$ifNull","fetchUser","user","findById","params","id","fetchUserDonation","userInvoices","Types","ObjectId","fetchUserCollections","userCollection","$match","$lookup","from","localField","foreignField","as","$first","itemName","category","fetchUserWishlist","userWishlist","get","module","exports"],"sources":["../../../../src/admin/routes/users/users.js"],"sourcesContent":["const express = require(\"express\");\nconst router = express.Router();\nconst User = require(\"../../../app/models/users/users\");\nconst Admin = require(\"../../models/admin\");\nconst Invoice = require(\"../../../app/models/users/invoice\");\nconst Wishlist = require(\"../../../app/models/users/wishlist\");\nconst Collection = require(\"../../../app/models/users/collections\");\nconst asyncHandler = require(\"../../../app/utils/asyncHandler\");\nconst { default: mongoose } = require(\"mongoose\");\n\nconst fetchAdmins = asyncHandler(async (req, res) => {\n\ttry {\n\t\tconst users = await Admin.find();\n\t\tres.status(200).json(users);\n\t} catch (error) {\n\t\tres.status(500).json({ message: error.message });\n\t}\n});\nconst fetchUsers = asyncHandler(async (req, res) => {\n\tconst page = parseInt(req.query.page) || 1;\n\tconst limit = parseInt(req.query.limit) || 10;\n\ttry {\n\t\tconst users = await User.aggregate([\n\t\t\t{\n\t\t\t\t$addFields: {\n\t\t\t\t\tcreated: {\n\t\t\t\t\t\t$ifNull: [\"$publish\", \"$createdAt\"],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t]);\n\n\t\tres.status(200).json(users);\n\t} catch (error) {\n\t\tres.status(500).json({ message: error.message });\n\t}\n});\nconst fetchUser = asyncHandler(async (req, res) => {\n\ttry {\n\t\tconst user = await User.findById(req.params.id);\n\n\t\tres.status(200).json(user);\n\t} catch (error) {\n\t\tres.status(500).json({ message: error.message });\n\t}\n});\nconst fetchUserDonation = asyncHandler(async (req, res) => {\n\ttry {\n\t\tconst userInvoices = await Invoice.find({\n\t\t\tuser: new mongoose.Types.ObjectId(req.params.id),\n\t\t});\n\t\tres.status(200).json(userInvoices);\n\t} catch (error) {\n\t\tres.status(500).json({ message: error.message });\n\t}\n});\nconst fetchUserCollections = asyncHandler(async (req, res) => {\n\ttry {\n\t\tconst userCollection = await Collection.aggregate([\n\t\t\t{\n\t\t\t\t$match: { user: new mongoose.Types.ObjectId(req.params.id) },\n\t\t\t},\n\t\t\t{\n\t\t\t\t$lookup: {\n\t\t\t\t\tfrom: \"pages\",\n\t\t\t\t\tlocalField: \"item\",\n\t\t\t\t\tforeignField: \"_id\",\n\t\t\t\t\tas: \"page\",\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$addFields: {\n\t\t\t\t\tpage: { $first: \"$page\" }, // Get the first matching page\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$addFields: {\n\t\t\t\t\titemName: { $ifNull: [\"$page.title\", \"\"] }, // Access page title safely\n\t\t\t\t\tcategory: { $ifNull: [\"$page.category\", \"\"] }, // Access page category safely\n\t\t\t\t},\n\t\t\t},\n\t\t]);\n\t\tres.status(200).json(userCollection);\n\t} catch (error) {\n\t\tres.status(500).json({ message: error.message });\n\t}\n});\nconst fetchUserWishlist = asyncHandler(async (req, res) => {\n\ttry {\n\t\tconst userWishlist = await Wishlist.aggregate([\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\tuser: new mongoose.Types.ObjectId(req.params.id),\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$lookup: {\n\t\t\t\t\tfrom: \"pages\",\n\t\t\t\t\tlocalField: \"item\",\n\t\t\t\t\tforeignField: \"_id\",\n\t\t\t\t\tas: \"page\",\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$addFields: {\n\t\t\t\t\tpage: { $first: \"$page\" }, // Get the first matching page\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$addFields: {\n\t\t\t\t\titemName: { $ifNull: [\"$page.title\", \"\"] }, // Access page title safely\n\t\t\t\t\tcategory: { $ifNull: [\"$page.category\", \"\"] }, // Access page category safely\n\t\t\t\t},\n\t\t\t},\n\t\t]);\n\t\tres.status(200).json(userWishlist);\n\t} catch (error) {\n\t\tres.status(500).json({ message: error.message });\n\t}\n});\n\nrouter.get(\"/find/donations/:id\", fetchUserDonation);\nrouter.get(\"/find/collections/:id\", fetchUserCollections);\nrouter.get(\"/find/wishlist/:id\", fetchUserWishlist);\nrouter.get(\"/admins\", fetchAdmins);\nrouter.get(\"/:id\", fetchUser);\nrouter.get(\"/\", fetchUsers);\n\nmodule.exports = router;\n"],"mappings":"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","ignoreList":[]}