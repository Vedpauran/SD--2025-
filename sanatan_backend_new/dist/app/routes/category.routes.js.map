{"version":3,"file":"category.routes.js","names":["express","require","router","Router","Category","asyncHandler","ObjectId","default","mongoose","getActiveCategoriesByLangId","req","res","langid","params","currentDate","Date","activeCategories","aggregate","$match","Status","CategoryIn","$expr","$eq","$lookup","from","localField","foreignField","as","pipeline","status","$or","publish","$lt","$gt","$size","$ifNull","$filter","input","$objectToArray","cond","$and","$addFields","Count","$project","Name","Icon","Bannercolor","Headfontcolor","Colorleft","Colorright","Names","categoryName","json","error","console","log","message","route","get","module","exports"],"sources":["../../../src/app/routes/category.routes.js"],"sourcesContent":["const express = require(\"express\");\nconst router = express.Router();\nconst Category = require(\"../../admin/models/category/mainCategory.model\");\nconst asyncHandler = require(\"../utils/asyncHandler\");\nconst { ObjectId } = require(\"mongodb\");\nconst { default: mongoose } = require(\"mongoose\");\n\nconst getActiveCategoriesByLangId = asyncHandler(async (req, res) => {\n\tconst { langid } = req.params;\n\tconst currentDate = new Date();\n\n\ttry {\n\t\tconst activeCategories = await Category.aggregate([\n\t\t\t// Match only active categories\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\tStatus: \"STATUS_ACTIVE\",\n\t\t\t\t\tCategoryIn: \"Pages\",\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\t$expr: {\n\t\t\t\t\t\t$eq: [`$Languages.${langid}.checked`, true],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\n\t\t\t{\n\t\t\t\t$lookup: {\n\t\t\t\t\tfrom: \"pages\",\n\t\t\t\t\tlocalField: \"Name\",\n\t\t\t\t\tforeignField: \"category\",\n\t\t\t\t\tas: \"pages\",\n\t\t\t\t\tpipeline: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$match: {\n\t\t\t\t\t\t\t\tstatus: \"STATUS_ACTIVE\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$match: {\n\t\t\t\t\t\t\t\t$or: [\n\t\t\t\t\t\t\t\t\t{ publish: { $lt: currentDate } },\n\t\t\t\t\t\t\t\t\t{ publish: null },\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$match: {\n\t\t\t\t\t\t\t\t$expr: {\n\t\t\t\t\t\t\t\t\t$gt: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t$size: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ifNull: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$filter: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinput: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$objectToArray: \"$Availability\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcond: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$and: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{ $eq: [\"$$this.v.checked\", true] },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$eq: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"$$this.v.value\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Available\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t[],\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$addFields: {\n\t\t\t\t\tCount: {\n\t\t\t\t\t\t$size: { $ifNull: [\"$pages\", []] },\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t// Project to include only necessary fields\n\t\t\t{\n\t\t\t\t$project: {\n\t\t\t\t\tCategoryIn: 1,\n\t\t\t\t\tName: 1,\n\t\t\t\t\tIcon: 1,\n\t\t\t\t\tBannercolor: 1,\n\t\t\t\t\tHeadfontcolor: 1,\n\t\t\t\t\tColorleft: 1,\n\t\t\t\t\tColorright: 1,\n\t\t\t\t\tNames: 1,\n\t\t\t\t\tCount: 1,\n\t\t\t\t\tcategoryName: `$Languages.${langid}.value`,\n\t\t\t\t},\n\t\t\t},\n\t\t]);\n\n\t\tres.status(200).json(activeCategories);\n\t} catch (error) {\n\t\tconsole.log(error);\n\t\tres.status(500).json({ message: error.message });\n\t}\n});\n\nrouter.route(\"/main/:langid\").get(getActiveCategoriesByLangId);\n\nmodule.exports = router;\n"],"mappings":"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","ignoreList":[]}