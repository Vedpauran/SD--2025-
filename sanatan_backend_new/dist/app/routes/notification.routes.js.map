{"version":3,"file":"notification.routes.js","names":["express","require","router","Router","Notification","asyncHandler","getActiveContentsByLangId","req","res","langid","query","currentDate","Date","contents","aggregate","$match","Language","$or","publish","$lt","$lookup","from","localField","foreignField","as","pipeline","Languages","Page","$ne","status","json","ApiResponse","error","message","route","get","module","exports"],"sources":["../../../src/app/routes/notification.routes.js"],"sourcesContent":["const express = require(\"express\");\nconst router = express.Router();\nconst Notification = require(\"../../admin/models/notification/notificationContent\");\nconst asyncHandler = require(\"../utils/asyncHandler\");\n\nconst getActiveContentsByLangId = asyncHandler(async (req, res) => {\n\tconst { langid } = req.query;\n\ttry {\n\t\tconst currentDate = new Date(); // Ensure currentDate is defined\n\t\tconst contents = await Notification.aggregate([\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\tLanguage: langid,\n\t\t\t\t\t$or: [{ publish: { $lt: currentDate } }, { publish: null }],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$lookup: {\n\t\t\t\t\tfrom: \"notifications\",\n\t\t\t\t\tlocalField: \"Page\",\n\t\t\t\t\tforeignField: \"_id\",\n\t\t\t\t\tas: \"Page\",\n\t\t\t\t\tpipeline: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$match: {\n\t\t\t\t\t\t\t\tLanguages: langid,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\tPage: {\n\t\t\t\t\t\t$ne: null || [],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t]);\n\n\t\tres.status(200).json(\n\t\t\tnew ApiResponse(\n\t\t\t\t200,\n\t\t\t\t{\n\t\t\t\t\tcontents,\n\t\t\t\t},\n\t\t\t\t\"Pages fetched Successfully\"\n\t\t\t)\n\t\t);\n\t} catch (error) {\n\t\tres.status(500).json({ message: error.message });\n\t}\n});\n\nrouter.route(\"/contents/:langid\").get(getActiveContentsByLangId);\n\nmodule.exports = router;\n"],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAMC,YAAY,GAAGH,OAAO,CAAC,qDAAqD,CAAC;AACnF,MAAMI,YAAY,GAAGJ,OAAO,CAAC,uBAAuB,CAAC;AAErD,MAAMK,yBAAyB,GAAGD,YAAY,CAAC,OAAOE,GAAG,EAAEC,GAAG,KAAK;EAClE,MAAM;IAAEC;EAAO,CAAC,GAAGF,GAAG,CAACG,KAAK;EAC5B,IAAI;IACH,MAAMC,WAAW,GAAG,IAAIC,IAAI,CAAC,CAAC,CAAC,CAAC;IAChC,MAAMC,QAAQ,GAAG,MAAMT,YAAY,CAACU,SAAS,CAAC,CAC7C;MACCC,MAAM,EAAE;QACPC,QAAQ,EAAEP,MAAM;QAChBQ,GAAG,EAAE,CAAC;UAAEC,OAAO,EAAE;YAAEC,GAAG,EAAER;UAAY;QAAE,CAAC,EAAE;UAAEO,OAAO,EAAE;QAAK,CAAC;MAC3D;IACD,CAAC,EACD;MACCE,OAAO,EAAE;QACRC,IAAI,EAAE,eAAe;QACrBC,UAAU,EAAE,MAAM;QAClBC,YAAY,EAAE,KAAK;QACnBC,EAAE,EAAE,MAAM;QACVC,QAAQ,EAAE,CACT;UACCV,MAAM,EAAE;YACPW,SAAS,EAAEjB;UACZ;QACD,CAAC;MAEH;IACD,CAAC,EACD;MACCM,MAAM,EAAE;QACPY,IAAI,EAAE;UACLC,GAAG,EAAE,IAAI,IAAI;QACd;MACD;IACD,CAAC,CACD,CAAC;IAEFpB,GAAG,CAACqB,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CACnB,IAAIC,WAAW,CACd,GAAG,EACH;MACClB;IACD,CAAC,EACD,4BACD,CACD,CAAC;EACF,CAAC,CAAC,OAAOmB,KAAK,EAAE;IACfxB,GAAG,CAACqB,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEG,OAAO,EAAED,KAAK,CAACC;IAAQ,CAAC,CAAC;EACjD;AACD,CAAC,CAAC;AAEF/B,MAAM,CAACgC,KAAK,CAAC,mBAAmB,CAAC,CAACC,GAAG,CAAC7B,yBAAyB,CAAC;AAEhE8B,MAAM,CAACC,OAAO,GAAGnC,MAAM","ignoreList":[]}