{"version":3,"file":"blogs.routes.js","names":["express","require","router","Router","Blog","BlogContent","asyncHandler","verifyJWT","ObjectId","ApiResponse","default","mongoose","currentDate","Date","getActiveContentsByLangId","req","res","langid","params","page","limit","query","contents","aggregate","$match","status","$or","publish","$lt","$addFields","availableLanguages","$map","input","$filter","$objectToArray","cond","$and","$eq","as","in","$expr","$gt","$size","availableLanguage","$cond","$in","$first","$lookup","from","localField","foreignField","favr","if","user","_id","then","else","let","pipeline","$project","Language","title","json","error","message","route","get","Types","id","collection","blog","module","exports"],"sources":["../../../src/app/routes/blogs.routes.js"],"sourcesContent":["const express = require(\"express\");\nconst router = express.Router();\nconst Blog = require(\"../../admin/models/blogs/blog\");\nconst BlogContent = require(\"../../admin/models/blogs/blogcontent.model\");\nconst asyncHandler = require(\"../utils/asyncHandler\");\nconst verifyJWT = require(\"../middleware/verifyjwt\");\nconst { ObjectId } = require(\"mongodb\");\nconst ApiResponse = require(\"../utils/apiresponse\");\nconst { default: mongoose } = require(\"mongoose\");\nconst currentDate = new Date();\nconst getActiveContentsByLangId = asyncHandler(async (req, res) => {\n\tconst langid = req.params.langid;\n\tconst { page = 1, limit = 10, query } = req.query;\n\n\ttry {\n\t\tconst contents = await Blog.aggregate([\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\tstatus: \"STATUS_ACTIVE\",\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\t$or: [{ publish: { $lt: currentDate } }, { publish: null }],\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$addFields: {\n\t\t\t\t\tavailableLanguages: {\n\t\t\t\t\t\t$map: {\n\t\t\t\t\t\t\tinput: {\n\t\t\t\t\t\t\t\t$filter: {\n\t\t\t\t\t\t\t\t\tinput: { $objectToArray: \"$Availability\" },\n\t\t\t\t\t\t\t\t\tcond: {\n\t\t\t\t\t\t\t\t\t\t$and: [\n\t\t\t\t\t\t\t\t\t\t\t{ $eq: [\"$$this.v.checked\", true] },\n\t\t\t\t\t\t\t\t\t\t\t{ $eq: [\"$$this.v.value\", \"Available\"] },\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tas: \"lang\",\n\t\t\t\t\t\t\tin: \"$$lang.k\", // Extract the language key\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$match: {\n\t\t\t\t\t$expr: { $gt: [{ $size: \"$availableLanguages\" }, 0] },\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$addFields: {\n\t\t\t\t\tavailableLanguage: {\n\t\t\t\t\t\t$cond: [\n\t\t\t\t\t\t\t{ $in: [langid, \"$availableLanguages\"] },\n\t\t\t\t\t\t\tlangid,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$cond: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$in: [\"$defaultLanguage\", \"$availableLanguages\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\"$defaultLanguage\",\n\t\t\t\t\t\t\t\t\t{ $first: \"$availableLanguages\" },\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$lookup: {\n\t\t\t\t\tfrom: \"wishlists\",\n\t\t\t\t\tlocalField: \"_id\",\n\t\t\t\t\tforeignField: \"item\",\n\t\t\t\t\tas: \"favr\",\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$addFields: {\n\t\t\t\t\tfavr: {\n\t\t\t\t\t\t$cond: {\n\t\t\t\t\t\t\tif: {\n\t\t\t\t\t\t\t\t$in: [req.user?._id, \"$favr.user\"],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tthen: true,\n\t\t\t\t\t\t\telse: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$lookup: {\n\t\t\t\t\tfrom: \"blogcontents\",\n\t\t\t\t\tlocalField: \"_id\",\n\t\t\t\t\tforeignField: \"Page\",\n\t\t\t\t\tas: \"content\",\n\t\t\t\t\tlet: { availableLanguage: \"$availableLanguage\" },\n\t\t\t\t\tpipeline: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$match: {\n\t\t\t\t\t\t\t\t$expr: { $eq: [\"$Language\", \"$$availableLanguage\"] }, // Use the variable in the match condition\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$project: {\n\t\t\t\t\t\t\t\tLanguage: 1,\n\t\t\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t\t\ttitle: 1,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t]);\n\n\t\tres.status(200).json(\n\t\t\tnew ApiResponse(\n\t\t\t\t200,\n\t\t\t\t{\n\t\t\t\t\tcontents,\n\t\t\t\t},\n\t\t\t\t\"Pages fetched Successfully\"\n\t\t\t)\n\t\t);\n\t} catch (error) {\n\t\tres.status(500).json({ message: error.message });\n\t}\n});\nrouter.route(\"/contents/:langid\").get(getActiveContentsByLangId);\n\nrouter.get(\n\t\"/:id\",\n\tasyncHandler(async (req, res) => {\n\t\ttry {\n\t\t\tconst contents = await BlogContent.aggregate([\n\t\t\t\t{\n\t\t\t\t\t$match: {\n\t\t\t\t\t\t_id: new mongoose.Types.ObjectId(req.params.id),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t$lookup: {\n\t\t\t\t\t\tfrom: \"blogs\",\n\t\t\t\t\t\tlocalField: \"Page\",\n\t\t\t\t\t\tforeignField: \"_id\",\n\t\t\t\t\t\tas: \"blog\",\n\t\t\t\t\t\tpipeline: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$lookup: {\n\t\t\t\t\t\t\t\t\tfrom: \"wishlists\",\n\t\t\t\t\t\t\t\t\tlocalField: \"_id\",\n\t\t\t\t\t\t\t\t\tforeignField: \"item\",\n\t\t\t\t\t\t\t\t\tas: \"favr\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$addFields: {\n\t\t\t\t\t\t\t\t\tfavr: {\n\t\t\t\t\t\t\t\t\t\t$cond: {\n\t\t\t\t\t\t\t\t\t\t\tif: {\n\t\t\t\t\t\t\t\t\t\t\t\t$in: [\n\t\t\t\t\t\t\t\t\t\t\t\t\treq.user?._id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? new mongoose.Types.ObjectId(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treq.user._id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"$favr.user\",\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tthen: true,\n\t\t\t\t\t\t\t\t\t\t\telse: false,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$lookup: {\n\t\t\t\t\t\t\t\t\tfrom: \"collections\",\n\t\t\t\t\t\t\t\t\tlocalField: \"_id\",\n\t\t\t\t\t\t\t\t\tforeignField: \"item\",\n\t\t\t\t\t\t\t\t\tas: \"collection\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$addFields: {\n\t\t\t\t\t\t\t\t\tcollection: {\n\t\t\t\t\t\t\t\t\t\t$cond: {\n\t\t\t\t\t\t\t\t\t\t\tif: {\n\t\t\t\t\t\t\t\t\t\t\t\t$in: [\n\t\t\t\t\t\t\t\t\t\t\t\t\treq.user?._id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? new mongoose.Types.ObjectId(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treq.user._id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"$collection.user\",\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tthen: true,\n\t\t\t\t\t\t\t\t\t\t\telse: false,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t$addFields: {\n\t\t\t\t\t\tblog: {\n\t\t\t\t\t\t\t$first: \"$blog\", // Use $Page to reference the array\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t]);\n\t\t\tres.status(200).json(\n\t\t\t\tnew ApiResponse(\n\t\t\t\t\t200,\n\n\t\t\t\t\tcontents[0],\n\n\t\t\t\t\t\"Pages fetched Successfully\"\n\t\t\t\t)\n\t\t\t);\n\t\t} catch (error) {\n\t\t\tres.status(500).json({ message: error.message });\n\t\t}\n\t})\n);\n\nmodule.exports = router;\n"],"mappings":"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","ignoreList":[]}