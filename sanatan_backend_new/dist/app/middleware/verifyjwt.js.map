{"version":3,"file":"verifyjwt.js","names":["jwt","require","User","asyncHandler","ApiError","Error","constructor","statusCode","message","errors","stack","data","success","captureStackTrace","verifyJWT","req","_","next","token","cookies","accessToken","header","replace","decodedToken","verify","process","env","ACCESS_TOKEN_SECRET","user","findById","_id","select","error","module","exports"],"sources":["../../../src/app/middleware/verifyjwt.js"],"sourcesContent":["const jwt = require(\"jsonwebtoken\");\nconst User = require(\"../models/users/users\");\nconst asyncHandler = require(\"../utils/asyncHandler\");\n\nclass ApiError extends Error {\n\tconstructor(\n\t\tstatusCode,\n\t\tmessage = \"Something went wrong\",\n\t\terrors = [],\n\t\tstack = \"\"\n\t) {\n\t\tsuper(message);\n\t\tthis.statusCode = statusCode;\n\t\tthis.data = null;\n\t\tthis.message = message;\n\t\tthis.success = false;\n\t\tthis.errors = errors;\n\n\t\tif (stack) {\n\t\t\tthis.stack = stack;\n\t\t} else {\n\t\t\tError.captureStackTrace(this, this.constructor);\n\t\t}\n\t}\n}\n\nconst verifyJWT = asyncHandler(async (req, _, next) => {\n\ttry {\n\t\tconst token =\n\t\t\treq.cookies?.accessToken ||\n\t\t\treq.header(\"Authorization\")?.replace(\"Bearer \", \"\");\n\n\t\t// console.log(token);\n\t\tif (!token) {\n\t\t\tthrow new ApiError(401, \"Unauthorized request\");\n\t\t}\n\n\t\tconst decodedToken = jwt.verify(\n\t\t\ttoken,\n\t\t\tprocess.env.ACCESS_TOKEN_SECRET\n\t\t);\n\n\t\tconst user = await User.findById(decodedToken?._id).select(\n\t\t\t\"-password -refreshToken\"\n\t\t);\n\n\t\tif (!user) {\n\t\t\tthrow new ApiError(401, \"Invalid Access Token\");\n\t\t}\n\n\t\treq.user = user;\n\t\tnext();\n\t} catch (error) {\n\t\tthrow new ApiError(401, error?.message || \"Invalid access token\");\n\t}\n});\n\nmodule.exports = verifyJWT;\n"],"mappings":"AAAA,MAAMA,GAAG,GAAGC,OAAO,CAAC,cAAc,CAAC;AACnC,MAAMC,IAAI,GAAGD,OAAO,CAAC,uBAAuB,CAAC;AAC7C,MAAME,YAAY,GAAGF,OAAO,CAAC,uBAAuB,CAAC;AAErD,MAAMG,QAAQ,SAASC,KAAK,CAAC;EAC5BC,WAAWA,CACVC,UAAU,EACVC,OAAO,GAAG,sBAAsB,EAChCC,MAAM,GAAG,EAAE,EACXC,KAAK,GAAG,EAAE,EACT;IACD,KAAK,CAACF,OAAO,CAAC;IACd,IAAI,CAACD,UAAU,GAAGA,UAAU;IAC5B,IAAI,CAACI,IAAI,GAAG,IAAI;IAChB,IAAI,CAACH,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACI,OAAO,GAAG,KAAK;IACpB,IAAI,CAACH,MAAM,GAAGA,MAAM;IAEpB,IAAIC,KAAK,EAAE;MACV,IAAI,CAACA,KAAK,GAAGA,KAAK;IACnB,CAAC,MAAM;MACNL,KAAK,CAACQ,iBAAiB,CAAC,IAAI,EAAE,IAAI,CAACP,WAAW,CAAC;IAChD;EACD;AACD;AAEA,MAAMQ,SAAS,GAAGX,YAAY,CAAC,OAAOY,GAAG,EAAEC,CAAC,EAAEC,IAAI,KAAK;EACtD,IAAI;IACH,MAAMC,KAAK,GACVH,GAAG,CAACI,OAAO,EAAEC,WAAW,IACxBL,GAAG,CAACM,MAAM,CAAC,eAAe,CAAC,EAAEC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;;IAEpD;IACA,IAAI,CAACJ,KAAK,EAAE;MACX,MAAM,IAAId,QAAQ,CAAC,GAAG,EAAE,sBAAsB,CAAC;IAChD;IAEA,MAAMmB,YAAY,GAAGvB,GAAG,CAACwB,MAAM,CAC9BN,KAAK,EACLO,OAAO,CAACC,GAAG,CAACC,mBACb,CAAC;IAED,MAAMC,IAAI,GAAG,MAAM1B,IAAI,CAAC2B,QAAQ,CAACN,YAAY,EAAEO,GAAG,CAAC,CAACC,MAAM,CACzD,yBACD,CAAC;IAED,IAAI,CAACH,IAAI,EAAE;MACV,MAAM,IAAIxB,QAAQ,CAAC,GAAG,EAAE,sBAAsB,CAAC;IAChD;IAEAW,GAAG,CAACa,IAAI,GAAGA,IAAI;IACfX,IAAI,CAAC,CAAC;EACP,CAAC,CAAC,OAAOe,KAAK,EAAE;IACf,MAAM,IAAI5B,QAAQ,CAAC,GAAG,EAAE4B,KAAK,EAAExB,OAAO,IAAI,sBAAsB,CAAC;EAClE;AACD,CAAC,CAAC;AAEFyB,MAAM,CAACC,OAAO,GAAGpB,SAAS","ignoreList":[]}